<button
  class="theme-toggle"
  type="button"
  data-theme-toggle
  aria-label="Toggle theme"
  aria-pressed="false"
>
  <span class="theme-toggle__icon theme-toggle__icon--sun" aria-hidden="true">ðŸŒž</span>
  <span class="theme-toggle__icon theme-toggle__icon--moon" aria-hidden="true">ðŸŒ™</span>
  <span class="theme-toggle__label">Toggle theme</span>
</button>

<script is:inline>
const storageKey = 'rr-theme';
const root = document.documentElement;
const toggleBtn = document.querySelector('[data-theme-toggle]');

const normaliseTheme = (theme) => (theme === 'dark' ? 'dark' : 'light');

const applyTheme = (theme) => {
  const normalised = normaliseTheme(theme);
  root.setAttribute('data-theme', normalised);
  if (toggleBtn) {
    const isDark = normalised === 'dark';
    toggleBtn.setAttribute('aria-pressed', String(isDark));
    toggleBtn.classList.toggle('is-dark', isDark);
  }
};

const storedTheme = localStorage.getItem(storageKey);
if (storedTheme === 'dark' || storedTheme === 'light') {
  applyTheme(storedTheme);
} else {
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  applyTheme(prefersDark ? 'dark' : 'light');
}

if (toggleBtn) {
  toggleBtn.addEventListener('click', () => {
    const current = normaliseTheme(root.getAttribute('data-theme'));
    const nextTheme = current === 'dark' ? 'light' : 'dark';
    applyTheme(nextTheme);
    localStorage.setItem(storageKey, nextTheme);
  });
}

const media = window.matchMedia('(prefers-color-scheme: dark)');
media.addEventListener('change', (event) => {
  if (!localStorage.getItem(storageKey)) {
    applyTheme(event.matches ? 'dark' : 'light');
  }
});
</script>

<style>
.theme-toggle {
  display: inline-flex;
  align-items: center;
  gap: var(--space-2xs);
  padding: var(--space-2xs) var(--space-sm);
  border-radius: var(--radius-sm);
  background: var(--color-fill-neutral-soft);
  color: var(--color-text-muted);
  font-size: var(--font-size-sm);
  transition: background 150ms ease, transform 150ms ease;
}

.theme-toggle:hover,
.theme-toggle:focus-visible {
  background: var(--color-fill-primary-soft);
  color: var(--color-primary-500);
}

.theme-toggle.is-dark {
  background: var(--color-fill-primary-strong);
  color: var(--color-text-inverse);
}

.theme-toggle__icon {
  font-size: 1.2rem;
}

.theme-toggle__icon--sun {
  display: inline;
}

.theme-toggle__icon--moon {
  display: none;
}

.theme-toggle.is-dark .theme-toggle__icon--sun {
  display: none;
}

.theme-toggle.is-dark .theme-toggle__icon--moon {
  display: inline;
}

.theme-toggle__label {
  font-weight: 600;
  letter-spacing: 0.01em;
}

@media (max-width: 720px) {
  .theme-toggle__label {
    display: none;
  }
}
</style>
