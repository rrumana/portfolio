---
import Button from '../ui/Button.astro';
import Heading from '../ui/Heading.astro';
import Text from '../ui/Text.astro';
import { Image } from 'astro:assets';

export interface Link {
  label: string;
  href: string;
  variant?: 'primary' | 'secondary' | 'ghost' | 'link';
}

export interface Props {
  title: string;
  summary: string;
  techStack?: string[];
  cta?: Link;
  secondaryCta?: Link;
  media?: string;
  mediaAlt?: string;
}

const props = Astro.props as Props;

const {
  title,
  summary,
  techStack = [],
  cta,
  secondaryCta,
  media,
  mediaAlt,
} = props;

const mediaIsGif = typeof media === 'string' && media.toLowerCase().endsWith('.gif');
---
<article class="project-card">
  {media && (
    <div class="project-card__media">
      {mediaIsGif ? (
        <img src={media} alt={mediaAlt ?? ''} loading="lazy" />
      ) : (
        <Image
          src={media}
          alt={mediaAlt ?? ''}
          class="project-card__image"
          loading="lazy"
          width={1366}
          height={767}
          fit="cover"
        />
      )}
    </div>
  )}
  <div class="project-card__body">
    <Heading level={3} size="lg">{title}</Heading>
    <Text tone="muted">{summary}</Text>
    {techStack.length > 0 && (
      <ul class="project-card__tags" aria-label="Tech stack">
        {techStack.map((item) => (
          <li>{item}</li>
        ))}
      </ul>
    )}
    {(cta || secondaryCta) && (
      <div class="project-card__actions">
        {cta && <Button href={cta.href} variant={cta.variant ?? 'primary'}>{cta.label}</Button>}
        {secondaryCta && (
          <Button href={secondaryCta.href} variant={secondaryCta.variant ?? 'secondary'}>
            {secondaryCta.label}
          </Button>
        )}
      </div>
    )}
  </div>
</article>

<style>
.project-card {
  display: grid;
  grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
  gap: var(--space-xl);
  padding: var(--space-xl);
  background: var(--color-surface-100);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--color-border-subtle);
  align-items: stretch;
  width: 100%;
}

.project-card__media {
  position: relative;
  border-radius: var(--radius-md);
  overflow: hidden;
  box-shadow: var(--shadow-xs);
  min-height: clamp(260px, 28vw, 360px);
}

.project-card__media :global(img),
.project-card__media img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.project-card__body {
  display: grid;
  gap: var(--space-md);
  align-content: start;
}

.project-card__tags {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-xs);
  list-style: none;
}

.project-card__tags li {
  padding: var(--space-2xs) var(--space-sm);
  background: var(--color-fill-primary-soft);
  color: var(--color-primary-500);
  border-radius: var(--radius-xs);
  font-size: var(--font-size-xs);
  font-weight: 600;
  letter-spacing: 0.02em;
}

.project-card__actions {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-sm);
}

@media (max-width: 1100px) {
  .project-card {
    grid-template-columns: 1fr;
  }

  .project-card__media {
    min-height: clamp(220px, 50vw, 320px);
  }
}

html[data-theme='dark'] .project-card {
  background: var(--color-surface-300);
  border: 1px solid var(--color-border-muted);
}

html[data-theme='dark'] .project-card__tags li {
  background: var(--color-fill-primary-strong);
  color: var(--color-text-inverse);
}
</style>
